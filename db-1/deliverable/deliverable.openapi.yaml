openapi: 3.0.3
info:
  title: Database db-1 - Database API Specification
  description: "This database implements a comprehensive chat/messaging system supporting\
    \ user profiles, chat rooms, messages, friend networks, notifications, file attachments,\
    \ anonymous chats, and chat invitations. The system is designed to work across\
    \ PostgreSQL database platforms.\n\n- User Management: User profiles with authentication,\
    \ roles, and AI character associations\n- Chat System: Multi-user chat rooms with\
    \ participants and message threads\n- Social Network: Friend connections with\
    \ status tracking (accepted, pending, declined)\n- Notifications: Real-time notification\
    \ system for user events\n- File Attachments: File sharing capabilities within\
    \ chats\n- Anonymous Chats: Temporary anonymous chat rooms with join codes\n-\
    \ Chat Invitations: Invitation system for chat room access\n\n- PostgreSQL: Full\
    \ support with UUID types, arrays, and JSONB\n\n---\n\n---\n\nThis section provides\
    \ a comprehensive data dictionary for all tables in the database, including column\
    \ names, data types, constraints, and descriptions. Tables are organized by functional\
    \ category for easier navigation.\n\nThe database consists of 11 tables organized\
    \ into logical groups:\n\n1. User Management: `profiles`\n2. Chat System: `chats`,\
    \ `chat_participants`, `messages`\n3. Social Network: `friends`\n4. Notifications:\
    \ `notifications`\n5. File Management: `file_attachments`\n6. Anonymous Features:\
    \ `anonymous_chats`, `anonymous_chat_users`, `anonymous_messages`\n7. Invitations:\
    \ `chat_invitations`\n\n---\n\nStores user profile information including authentication\
    \ details, preferences, and AI character associations.\n\n| Column | Type | Nullable\
    \ | Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `id` | `UUID` | No | `gen_random_uuid()` | Primary key - unique user identifier\
    \ |\n| `username` | `VARCHAR(255)` | No | — | Unique username for login |\n| `display_name`\
    \ | `VARCHAR(255)` | No | — | Display name shown in UI |\n| `avatar_url` | `VARCHAR(16777216)`\
    \ | No | — | URL to user avatar image |\n| `created_at` | `TIMESTAMP_NTZ` | No\
    \ | `CURRENT_TIMESTAMP()` | Account creation timestamp |\n| `updated_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Last profile update timestamp |\n| `ai_character_id`\
    \ | `VARCHAR(255)` | Yes | `NULL` | Associated AI character identifier |\n| `user_role`\
    \ | `VARCHAR(50)` | No | `'user'` | User role (user, admin, moderator) |\n| `email`\
    \ | `VARCHAR(255)` | No | — | User email address |\n| `bio` | `VARCHAR(16777216)`\
    \ | Yes | `NULL` | User biography text |\n| `last_username_changed_at` | `TIMESTAMP_NTZ`\
    \ | Yes | `NULL` | Timestamp of last username change |\n| `prompt_username_setup`\
    \ | `BOOLEAN` | No | `FALSE` | Flag indicating if username setup was prompted\
    \ |\n\nIndexes:\n- Primary Key: `id`\n- Unique Index: `username`\n- Index: `email`\n\
    - Index: `created_at`\n\nConstraints:\n- `username` must be unique\n- `email`\
    \ must be unique\n\n---\n\nStores chat room information including metadata and\
    \ AI character associations.\n\n| Column | Type | Nullable | Default | Description\
    \ |\n|--------|------|----------|---------|-------------|\n| `id` | `UUID` | No\
    \ | `gen_random_uuid()` | Primary key - unique chat identifier |\n| `title` |\
    \ `VARCHAR(255)` | No | — | Chat room title |\n| `created_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Chat creation timestamp |\n| `updated_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Last update timestamp |\n| `current_ai_character_id`\
    \ | `VARCHAR(255)` | Yes | `NULL` | Currently active AI character |\n| `created_by`\
    \ | `UUID` | No | — | Foreign key to `profiles.id` - creator |\n\nIndexes:\n-\
    \ Primary Key: `id`\n- Foreign Key: `created_by` → `profiles.id`\n- Index: `created_at`\n\
    - Index: `updated_at`\n\n---\n\nJunction table linking users to chat rooms they\
    \ participate in.\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `chat_id` | `UUID` | No | — | Foreign key to `chats.id` |\n| `user_id` | `UUID`\
    \ | No | — | Foreign key to `profiles.id` |\n| `joined_at` | `TIMESTAMP_NTZ` |\
    \ No | `CURRENT_TIMESTAMP()` | Timestamp when user joined |\n\nIndexes:\n- Composite\
    \ Primary Key: `(chat_id, user_id)`\n- Foreign Key: `chat_id` → `chats.id`\n-\
    \ Foreign Key: `user_id` → `profiles.id`\n- Index: `joined_at`\n\nConstraints:\n\
    - Unique combination of `chat_id` and `user_id`\n\n---\n\nStores individual messages\
    \ within chat rooms, supporting both user and AI-generated messages.\n\n| Column\
    \ | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `id` | `UUID` | No | `gen_random_uuid()` | Primary key - unique message identifier\
    \ |\n| `chat_id` | `UUID` | No | — | Foreign key to `chats.id` |\n| `sender_id`\
    \ | `UUID` | Yes | `NULL` | Foreign key to `profiles.id` (NULL for system messages)\
    \ |\n| `content` | `VARCHAR(16777216)` | No | — | Message text content |\n| `is_ai`\
    \ | `BOOLEAN` | No | `FALSE` | Flag indicating AI-generated message |\n| `ai_character_id`\
    \ | `VARCHAR(255)` | Yes | `NULL` | AI character identifier if AI message |\n\
    | `created_at` | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()` | Message creation\
    \ timestamp |\n| `updated_at` | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()` |\
    \ Last update timestamp |\n| `deleted_at` | `TIMESTAMP_NTZ` | Yes | `NULL` | Soft\
    \ delete timestamp |\n| `mentioned_users` | `ARRAY(VARCHAR)` | Yes | `NULL` |\
    \ Array of mentioned user IDs |\n| `is_system_message` | `BOOLEAN` | No | `FALSE`\
    \ | Flag indicating system-generated message |\n| `mentions_data` | `VARIANT`\
    \ | Yes | `NULL` | JSON data for mentions  |\n\nIndexes:\n- Primary Key: `id`\n\
    - Foreign Key: `chat_id` → `chats.id`\n- Foreign Key: `sender_id` → `profiles.id`\n\
    - Index: `created_at`\n- Index: `(chat_id, created_at)`\n- Index: `deleted_at`\
    \ WHERE `deleted_at IS NULL`\n\nConstraints:\n- `sender_id` must be NULL if `is_system_message`\
    \ is TRUE\n- `content` cannot be empty\n\n---\n\nStores friend relationships between\
    \ users with status tracking.\n\n| Column | Type | Nullable | Default | Description\
    \ |\n|--------|------|----------|---------|-------------|\n| `id` | `UUID` | No\
    \ | `gen_random_uuid()` | Primary key |\n| `user_id` | `UUID` | No | — | Foreign\
    \ key to `profiles.id` - requester |\n| `friend_id` | `UUID` | No | — | Foreign\
    \ key to `profiles.id` - friend |\n| `status` | `VARCHAR(20)` | No | `'pending'`\
    \ | Relationship status (pending, accepted, declined) |\n| `created_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Request creation timestamp |\n| `updated_at`\
    \ | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()` | Last status update timestamp\
    \ |\n\nIndexes:\n- Primary Key: `id`\n- Foreign Key: `user_id` → `profiles.id`\n\
    - Foreign Key: `friend_id` → `profiles.id`\n- Unique Index: `(user_id, friend_id)`\n\
    - Index: `status`\n- Index: `updated_at`\n\nConstraints:\n- `user_id` cannot equal\
    \ `friend_id`\n- Unique combination of `user_id` and `friend_id`\n\n---\n\nStores\
    \ user notifications for various events.\n\n| Column | Type | Nullable | Default\
    \ | Description |\n|--------|------|----------|---------|-------------|\n| `id`\
    \ | `UUID` | No | `gen_random_uuid()` | Primary key |\n| `user_id` | `UUID` |\
    \ No | — | Foreign key to `profiles.id` |\n| `type` | `VARCHAR(50)` | No | — |\
    \ Notification type (message, friend_request, etc.) |\n| `title` | `VARCHAR(255)`\
    \ | No | — | Notification title |\n| `message` | `VARCHAR(16777216)` | No | —\
    \ | Notification message content |\n| `data` | `VARIANT` | Yes | `NULL` | Additional\
    \ JSON data  |\n| `created_at` | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()`\
    \ | Creation timestamp |\n| `read` | `BOOLEAN` | No | `FALSE` | Read status flag\
    \ |\n| `updated_at` | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()` | Last update\
    \ timestamp |\n| `seen_at` | `TIMESTAMP_NTZ` | Yes | `NULL` | Timestamp when notification\
    \ was seen |\n\nIndexes:\n- Primary Key: `id`\n- Foreign Key: `user_id` → `profiles.id`\n\
    - Index: `(user_id, read)`\n- Index: `created_at`\n- Index: `type`\n\n---\n\n\
    Stores file attachment metadata for messages.\n\n| Column | Type | Nullable |\
    \ Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `id` | `UUID` | No | `gen_random_uuid()` | Primary key |\n| `message_id` | `UUID`\
    \ | Yes | `NULL` | Foreign key to `messages.id` |\n| `chat_id` | `UUID` | Yes\
    \ | `NULL` | Foreign key to `chats.id` |\n| `user_id` | `UUID` | Yes | `NULL`\
    \ | Foreign key to `profiles.id` - uploader |\n| `file_name` | `VARCHAR(255)`\
    \ | No | — | Original filename |\n| `file_size` | `INTEGER` | No | — | File size\
    \ in bytes |\n| `file_type` | `VARCHAR(100)` | No | — | MIME type |\n| `file_path`\
    \ | `VARCHAR(16777216)` | No | — | Storage path/URL |\n| `created_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Upload timestamp |\n\nIndexes:\n- Primary Key:\
    \ `id`\n- Foreign Key: `message_id` → `messages.id`\n- Foreign Key: `chat_id`\
    \ → `chats.id`\n- Foreign Key: `user_id` → `profiles.id`\n- Index: `created_at`\n\
    \n---\n\nStores temporary anonymous chat rooms with join codes.\n\n| Column |\
    \ Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `id` | `UUID` | No | `gen_random_uuid()` | Primary key |\n| `join_code` | `VARCHAR(50)`\
    \ | Yes | `NULL` | Unique join code for anonymous access |\n| `created_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Creation timestamp |\n| `expires_at` | `TIMESTAMP_NTZ`\
    \ | Yes | `NULL` | Expiration timestamp |\n\nIndexes:\n- Primary Key: `id`\n-\
    \ Unique Index: `join_code`\n- Index: `expires_at`\n\n---\n\nStores anonymous\
    \ users participating in anonymous chats.\n\n| Column | Type | Nullable | Default\
    \ | Description |\n|--------|------|----------|---------|-------------|\n| `id`\
    \ | `UUID` | No | `gen_random_uuid()` | Primary key |\n| `chat_id` | `UUID` |\
    \ No | — | Foreign key to `anonymous_chats.id` |\n| `guest_id` | `VARCHAR(100)`\
    \ | Yes | `NULL` | Temporary guest identifier |\n| `created_at` | `TIMESTAMP_NTZ`\
    \ | No | `CURRENT_TIMESTAMP()` | Join timestamp |\n\nIndexes:\n- Primary Key:\
    \ `id`\n- Foreign Key: `chat_id` → `anonymous_chats.id`\n- Index: `guest_id`\n\
    \n---\n\nStores messages in anonymous chat rooms.\n\n| Column | Type | Nullable\
    \ | Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `id` | `UUID` | No | `gen_random_uuid()` | Primary key |\n| `chat_id` | `UUID`\
    \ | No | — | Foreign key to `anonymous_chats.id` |\n| `guest_id` | `VARCHAR(100)`\
    \ | Yes | `NULL` | Guest identifier of sender |\n| `content` | `VARCHAR(16777216)`\
    \ | No | — | Message content |\n| `created_at` | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()`\
    \ | Message timestamp |\n\nIndexes:\n- Primary Key: `id`\n- Foreign Key: `chat_id`\
    \ → `anonymous_chats.id`\n- Index: `created_at`\n- Index: `(chat_id, created_at)`\n\
    \n---\n\nStores chat room invitations sent between users.\n\n| Column | Type |\
    \ Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n\
    | `id` | `UUID` | No | `gen_random_uuid()` | Primary key |\n| `chat_id` | `UUID`\
    \ | No | — | Foreign key to `chats.id` |\n| `inviting_user_id` | `UUID` | No |\
    \ — | Foreign key to `profiles.id` - inviter |\n| `invited_user_id` | `UUID` |\
    \ No | — | Foreign key to `profiles.id` - invitee |\n| `status` | `VARCHAR(20)`\
    \ | No | `'pending'` | Invitation status (pending, accepted, declined) |\n| `created_at`\
    \ | `TIMESTAMP_NTZ` | No | `CURRENT_TIMESTAMP()` | Invitation timestamp |\n\n\
    Indexes:\n- Primary Key: `id`\n- Foreign Key: `chat_id` → `chats.id`\n- Foreign\
    \ Key: `inviting_user_id` → `profiles.id`\n- Foreign Key: `invited_user_id` →\
    \ `profiles.id`\n- Unique Index: `(chat_id, invited_user_id)`\n- Index: `status`\n\
    - Index: `created_at`\n\n---\n\n---\n\n---\n\nThis database includes 30 production\
    \ SQL queries, each designed to solve specific business problems for companies\
    \ with $1M+ ARR. Each query includes:\n\n- Business Use Case: The specific business\
    \ problem this query solves\n- Description: Technical explanation of what the\
    \ query does\n- Client Deliverable: What output or report this query generates\n\
    - Business Value: The business impact and value delivered\n- Complexity: Technical\
    \ complexity indicators\n- SQL Code: Complete, production-ready SQL query\n\n\
    ---\n\nUse Case: Business analytics for multi-window time-series analysis with\
    \ rolling aggregates\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and day-level grouping.\n\nUse Case: Business analytics for multi-window\
    \ time-series analysis with rolling aggregates\n\nBusiness Value: Actionable insights\
    \ from multi-window time-series analysis with rolling aggregates\n\nPurpose: Production\
    \ multi-window time-series analysis with rolling aggregates analysis\n\nComplexity:\
    \ 4 CTEs, 7 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by day and hex\n\n---\n\nUse Case: Business\
    \ analytics for segmentation analysis with decile ranking\n\nDescription: Uses\
    \ 4 CTEs with window functions, statistical aggregations, and week-level grouping.\n\
    \nUse Case: Business analytics for segmentation analysis with decile ranking\n\
    \nBusiness Value: Actionable insights from segmentation analysis with decile ranking\n\
    \nPurpose: Production segmentation analysis with decile ranking analysis\n\nComplexity:\
    \ 4 CTEs, 8 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by week and speed\n\n---\n\nUse Case: Business\
    \ analytics for performance quartile distribution\n\nDescription: Uses 4 CTEs\
    \ with window functions, statistical aggregations, and month-level grouping.\n\
    \nUse Case: Business analytics for performance quartile distribution\n\nBusiness\
    \ Value: Actionable insights from performance quartile distribution\n\nPurpose:\
    \ Production performance quartile distribution analysis\n\nComplexity: 4 CTEs,\
    \ 9 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected Output:\
    \ Aggregated metrics grouped by month and hex\n\n---\n\nUse Case: Business analytics\
    \ for category revenue distribution analysis\n\nDescription: Uses 4 CTEs with\
    \ window functions, statistical aggregations, and day-level grouping.\n\nUse Case:\
    \ Business analytics for category revenue distribution analysis\n\nBusiness Value:\
    \ Actionable insights from category revenue distribution analysis\n\nPurpose:\
    \ Production category revenue distribution analysis analysis\n\nComplexity: 4\
    \ CTEs, 6 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by day and speed\n\n---\n\nUse Case: Business\
    \ analytics for velocity and acceleration metrics\n\nDescription: Uses 4 CTEs\
    \ with window functions, statistical aggregations, and week-level grouping.\n\n\
    Use Case: Business analytics for velocity and acceleration metrics\n\nBusiness\
    \ Value: Actionable insights from velocity and acceleration metrics\n\nPurpose:\
    \ Production velocity and acceleration metrics analysis\n\nComplexity: 4 CTEs,\
    \ 7 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected Output:\
    \ Aggregated metrics grouped by week and hex\n\n---\n\nUse Case: Business analytics\
    \ for hourly pattern detection and clustering\n\nDescription: Uses 4 CTEs with\
    \ window functions, statistical aggregations, and day-level grouping.\n\nUse Case:\
    \ Business analytics for hourly pattern detection and clustering\n\nBusiness Value:\
    \ Actionable insights from hourly pattern detection and clustering\n\nPurpose:\
    \ Production hourly pattern detection and clustering analysis\n\nComplexity: 4\
    \ CTEs, 8 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by day and speed\n\n---\n\nUse Case: Business\
    \ analytics for gap analysis with sequential difference\n\nDescription: Uses 4\
    \ CTEs with window functions, statistical aggregations, and month-level grouping.\n\
    \nUse Case: Business analytics for gap analysis with sequential difference\n\n\
    Business Value: Actionable insights from gap analysis with sequential difference\n\
    \nPurpose: Production gap analysis with sequential difference analysis\n\nComplexity:\
    \ 4 CTEs, 9 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by month and hex\n\n---\n\nUse Case: Business\
    \ analytics for anomaly detection using z-score windows\n\nDescription: Uses 4\
    \ CTEs with window functions, statistical aggregations, and day-level grouping.\n\
    \nUse Case: Business analytics for anomaly detection using z-score windows\n\n\
    Business Value: Actionable insights from anomaly detection using z-score windows\n\
    \nPurpose: Production anomaly detection using z-score windows analysis\n\nComplexity:\
    \ 4 CTEs, 6 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by day and speed\n\n---\n\nUse Case: Business\
    \ analytics for recency-frequency scoring model\n\nDescription: Uses 4 CTEs with\
    \ window functions, statistical aggregations, and week-level grouping.\n\nUse\
    \ Case: Business analytics for recency-frequency scoring model\n\nBusiness Value:\
    \ Actionable insights from recency-frequency scoring model\n\nPurpose: Production\
    \ recency-frequency scoring model analysis\n\nComplexity: 4 CTEs, 7 window functions,\
    \ GROUP BY with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics\
    \ grouped by week and hex\n\n---\n\nUse Case: Business analytics for multi-period\
    \ cohort retention analysis\n\nDescription: Uses 4 CTEs with window functions,\
    \ statistical aggregations, and month-level grouping.\n\nUse Case: Business analytics\
    \ for multi-period cohort retention analysis\n\nBusiness Value: Actionable insights\
    \ from multi-period cohort retention analysis\n\nPurpose: Production multi-period\
    \ cohort retention analysis analysis\n\nComplexity: 4 CTEs, 8 window functions,\
    \ GROUP BY with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics\
    \ grouped by month and speed\n\n---\n\nUse Case: Business analytics for second-order\
    \ derivative computation\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and day-level grouping.\n\nUse Case: Business analytics for second-order\
    \ derivative computation\n\nBusiness Value: Actionable insights from second-order\
    \ derivative computation\n\nPurpose: Production second-order derivative computation\
    \ analysis\n\nComplexity: 4 CTEs, 9 window functions, GROUP BY with HAVING, date\
    \ arithmetic\n\nExpected Output: Aggregated metrics grouped by day and hex\n\n\
    ---\n\nUse Case: Business analytics for cross-category benchmarking with percentiles\n\
    \nDescription: Uses 4 CTEs with window functions, statistical aggregations, and\
    \ week-level grouping.\n\nUse Case: Business analytics for cross-category benchmarking\
    \ with percentiles\n\nBusiness Value: Actionable insights from cross-category\
    \ benchmarking with percentiles\n\nPurpose: Production cross-category benchmarking\
    \ with percentiles analysis\n\nComplexity: 4 CTEs, 6 window functions, GROUP BY\
    \ with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics grouped\
    \ by week and speed\n\n---\n\nUse Case: Business analytics for weighted moving\
    \ average pipeline\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and month-level grouping.\n\nUse Case: Business analytics for\
    \ weighted moving average pipeline\n\nBusiness Value: Actionable insights from\
    \ weighted moving average pipeline\n\nPurpose: Production weighted moving average\
    \ pipeline analysis\n\nComplexity: 4 CTEs, 7 window functions, GROUP BY with HAVING,\
    \ date arithmetic\n\nExpected Output: Aggregated metrics grouped by month and\
    \ hex\n\n---\n\nUse Case: Business analytics for peak period identification and\
    \ efficiency\n\nDescription: Uses 4 CTEs with window functions, statistical aggregations,\
    \ and day-level grouping.\n\nUse Case: Business analytics for peak period identification\
    \ and efficiency\n\nBusiness Value: Actionable insights from peak period identification\
    \ and efficiency\n\nPurpose: Production peak period identification and efficiency\
    \ analysis\n\nComplexity: 4 CTEs, 8 window functions, GROUP BY with HAVING, date\
    \ arithmetic\n\nExpected Output: Aggregated metrics grouped by day and speed\n\
    \n---\n\nUse Case: Business analytics for lifetime value estimation model\n\n\
    Description: Uses 4 CTEs with window functions, statistical aggregations, and\
    \ week-level grouping.\n\nUse Case: Business analytics for lifetime value estimation\
    \ model\n\nBusiness Value: Actionable insights from lifetime value estimation\
    \ model\n\nPurpose: Production lifetime value estimation model analysis\n\nComplexity:\
    \ 4 CTEs, 9 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by week and hex\n\n---\n\nUse Case: Business\
    \ analytics for year-over-year growth rate analysis\n\nDescription: Uses 4 CTEs\
    \ with window functions, statistical aggregations, and month-level grouping.\n\
    \nUse Case: Business analytics for year-over-year growth rate analysis\n\nBusiness\
    \ Value: Actionable insights from year-over-year growth rate analysis\n\nPurpose:\
    \ Production year-over-year growth rate analysis analysis\n\nComplexity: 4 CTEs,\
    \ 6 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected Output:\
    \ Aggregated metrics grouped by month and speed\n\n---\n\nUse Case: Business analytics\
    \ for heatmap data generation by dimensions\n\nDescription: Uses 4 CTEs with window\
    \ functions, statistical aggregations, and day-level grouping.\n\nUse Case: Business\
    \ analytics for heatmap data generation by dimensions\n\nBusiness Value: Actionable\
    \ insights from heatmap data generation by dimensions\n\nPurpose: Production heatmap\
    \ data generation by dimensions analysis\n\nComplexity: 4 CTEs, 7 window functions,\
    \ GROUP BY with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics\
    \ grouped by day and hex\n\n---\n\nUse Case: Business analytics for running percentile\
    \ distribution\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and week-level grouping.\n\nUse Case: Business analytics for running\
    \ percentile distribution\n\nBusiness Value: Actionable insights from running\
    \ percentile distribution\n\nPurpose: Production running percentile distribution\
    \ analysis\n\nComplexity: 4 CTEs, 8 window functions, GROUP BY with HAVING, date\
    \ arithmetic\n\nExpected Output: Aggregated metrics grouped by week and speed\n\
    \n---\n\nUse Case: Business analytics for cross-correlation pattern analysis\n\
    \nDescription: Uses 4 CTEs with window functions, statistical aggregations, and\
    \ month-level grouping.\n\nUse Case: Business analytics for cross-correlation\
    \ pattern analysis\n\nBusiness Value: Actionable insights from cross-correlation\
    \ pattern analysis\n\nPurpose: Production cross-correlation pattern analysis analysis\n\
    \nComplexity: 4 CTEs, 9 window functions, GROUP BY with HAVING, date arithmetic\n\
    \nExpected Output: Aggregated metrics grouped by month and hex\n\n---\n\nUse Case:\
    \ Business analytics for status transition forensic analysis\n\nDescription: Uses\
    \ 4 CTEs with window functions, statistical aggregations, and day-level grouping.\n\
    \nUse Case: Business analytics for status transition forensic analysis\n\nBusiness\
    \ Value: Actionable insights from status transition forensic analysis\n\nPurpose:\
    \ Production status transition forensic analysis analysis\n\nComplexity: 4 CTEs,\
    \ 6 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected Output:\
    \ Aggregated metrics grouped by day and speed\n\n---\n\nUse Case: Business analytics\
    \ for multi-metric dashboard aggregation\n\nDescription: Uses 4 CTEs with window\
    \ functions, statistical aggregations, and week-level grouping.\n\nUse Case: Business\
    \ analytics for multi-metric dashboard aggregation\n\nBusiness Value: Actionable\
    \ insights from multi-metric dashboard aggregation\n\nPurpose: Production multi-metric\
    \ dashboard aggregation analysis\n\nComplexity: 4 CTEs, 7 window functions, GROUP\
    \ BY with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics grouped\
    \ by week and hex\n\n---\n\nUse Case: Business analytics for sequential pattern\
    \ mining with windows\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and month-level grouping.\n\nUse Case: Business analytics for\
    \ sequential pattern mining with windows\n\nBusiness Value: Actionable insights\
    \ from sequential pattern mining with windows\n\nPurpose: Production sequential\
    \ pattern mining with windows analysis\n\nComplexity: 4 CTEs, 8 window functions,\
    \ GROUP BY with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics\
    \ grouped by month and speed\n\n---\n\nUse Case: Business analytics for concentration\
    \ index computation\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and day-level grouping.\n\nUse Case: Business analytics for concentration\
    \ index computation\n\nBusiness Value: Actionable insights from concentration\
    \ index computation\n\nPurpose: Production concentration index computation analysis\n\
    \nComplexity: 4 CTEs, 9 window functions, GROUP BY with HAVING, date arithmetic\n\
    \nExpected Output: Aggregated metrics grouped by day and hex\n\n---\n\nUse Case:\
    \ Business analytics for statistical anomaly score assignment\n\nDescription:\
    \ Uses 4 CTEs with window functions, statistical aggregations, and week-level\
    \ grouping.\n\nUse Case: Business analytics for statistical anomaly score assignment\n\
    \nBusiness Value: Actionable insights from statistical anomaly score assignment\n\
    \nPurpose: Production statistical anomaly score assignment analysis\n\nComplexity:\
    \ 4 CTEs, 6 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected\
    \ Output: Aggregated metrics grouped by week and speed\n\n---\n\nUse Case: Business\
    \ analytics for fiscal period comparative reporting\n\nDescription: Uses 4 CTEs\
    \ with window functions, statistical aggregations, and month-level grouping.\n\
    \nUse Case: Business analytics for fiscal period comparative reporting\n\nBusiness\
    \ Value: Actionable insights from fiscal period comparative reporting\n\nPurpose:\
    \ Production fiscal period comparative reporting analysis\n\nComplexity: 4 CTEs,\
    \ 7 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected Output:\
    \ Aggregated metrics grouped by month and hex\n\n---\n\nUse Case: Business analytics\
    \ for throughput optimization metrics\n\nDescription: Uses 4 CTEs with window\
    \ functions, statistical aggregations, and day-level grouping.\n\nUse Case: Business\
    \ analytics for throughput optimization metrics\n\nBusiness Value: Actionable\
    \ insights from throughput optimization metrics\n\nPurpose: Production throughput\
    \ optimization metrics analysis\n\nComplexity: 4 CTEs, 8 window functions, GROUP\
    \ BY with HAVING, date arithmetic\n\nExpected Output: Aggregated metrics grouped\
    \ by day and speed\n\n---\n\nUse Case: Business analytics for cumulative trend\
    \ analysis pipeline\n\nDescription: Uses 4 CTEs with window functions, statistical\
    \ aggregations, and week-level grouping.\n\nUse Case: Business analytics for cumulative\
    \ trend analysis pipeline\n\nBusiness Value: Actionable insights from cumulative\
    \ trend analysis pipeline\n\nPurpose: Production cumulative trend analysis pipeline\
    \ analysis\n\nComplexity: 4 CTEs, 9 window functions, GROUP BY with HAVING, date\
    \ arithmetic\n\nExpected Output: Aggregated metrics grouped by week and hex\n\n\
    ---\n\nUse Case: Business analytics for multi-dimensional pivot aggregation\n\n\
    Description: Uses 4 CTEs with window functions, statistical aggregations, and\
    \ month-level grouping.\n\nUse Case: Business analytics for multi-dimensional\
    \ pivot aggregation\n\nBusiness Value: Actionable insights from multi-dimensional\
    \ pivot aggregation\n\nPurpose: Production multi-dimensional pivot aggregation\
    \ analysis\n\nComplexity: 4 CTEs, 6 window functions, GROUP BY with HAVING, date\
    \ arithmetic\n\nExpected Output: Aggregated metrics grouped by month and speed\n\
    \n---\n\nUse Case: Business analytics for funnel stage progression tracking\n\n\
    Description: Uses 4 CTEs with window functions, statistical aggregations, and\
    \ day-level grouping.\n\nUse Case: Business analytics for funnel stage progression\
    \ tracking\n\nBusiness Value: Actionable insights from funnel stage progression\
    \ tracking\n\nPurpose: Production funnel stage progression tracking analysis\n\
    \nComplexity: 4 CTEs, 7 window functions, GROUP BY with HAVING, date arithmetic\n\
    \nExpected Output: Aggregated metrics grouped by day and hex\n\n---\n\nUse Case:\
    \ Business analytics for outlier detection with iqr method\n\nDescription: Uses\
    \ 4 CTEs with window functions, statistical aggregations, and week-level grouping.\n\
    \nUse Case: Business analytics for outlier detection with iqr method\n\nBusiness\
    \ Value: Actionable insights from outlier detection with iqr method\n\nPurpose:\
    \ Production outlier detection with iqr method analysis\n\nComplexity: 4 CTEs,\
    \ 8 window functions, GROUP BY with HAVING, date arithmetic\n\nExpected Output:\
    \ Aggregated metrics grouped by week and speed\n\n---\n\n1. Database Access: Ensure\
    \ you have access to the database instance (PostgreSQL)\n2. Credentials: Obtain\
    \ database connection credentials\n3. Schema: Ensure all tables are created and\
    \ populated with data\n\n1. Open Query File: Navigate to `queries/queries.md`\n\
    2. Select Query: Choose the query number you want to execute\n3. Copy SQL: Copy\
    \ the SQL code from the code block\n4. Execute: Run the query in your database\
    \ client:\n   - PostgreSQL: Use `psql` or pgAdmin\n\n- Each query includes an\
    \ \"Expected Output\" section describing the result set\n- Review the query description\
    \ to understand what metrics are being calculated\n- Check the complexity notes\
    \ to understand the SQL patterns used\n\n1. Create a new notebook\n2. Set the\
    \ language to SQL\n3. Copy the query SQL into a cell\n4. Add markdown cells above\
    \ for context:\n   \n5. Execute the cell to run the query\n6. Review results and\
    \ add visualization cells as needed\n\n1. Create Tables: Execute the schema creation\
    \ scripts\n2. Create Indexes: Ensure all indexes are created for performance\n\
    3. Load Data: Populate tables with sample or production data\n4. Verify: Run validation\
    \ queries to ensure data integrity\n\n- All queries are designed for distributed\
    \ systems\n- Indexes are critical for query performance\n- Consider partitioning\
    \ large tables (messages, notifications) by date\n- Monitor query execution times\
    \ and optimize as needed\n\n- Queries use standard SQL syntax where possible\n\
    - Some database-specific features are abstracted:\n  - PostgreSQL: Uses `ARRAY`\
    \ types\n  : Uses compatible array functions\n  : Uses `VARIANT` for JSON data\n\
    - Test queries on your target database before production use\n\n---\n\n---\n\n\
    All queries in this database are designed to work across multiple database platforms:\n\
    \n- PostgreSQL: Full support with standard SQL features\n\nQueries use standard\
    \ SQL syntax and avoid platform-specific features to ensure compatibility.\n\n\
    ---\n\nDocument Information:\n\n- Generated: 20260210-0115\n- Database: db-1\n\
    - Type: Chat/Messaging System\n- Queries: 30 production queries\n- Status: ✅ Complete\
    \ Comprehensive Deliverable"
  version: 1.0.0
  contact:
    name: Database Team
  license:
    name: MIT
servers:
- url: postgresql://localhost:5432/db_1
  description: PostgreSQL Server
tags:
- name: schema
  description: Database schema information
- name: tables
  description: Table definitions and structures
- name: queries
  description: SQL query definitions and metadata
- name: relationships
  description: Table relationships and foreign keys
paths:
  /schema:
    get:
      tags:
      - schema
      summary: Get database schema overview
      description: Returns overview information about the database schema
      responses:
        '200':
          description: Schema overview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaOverview'
  /tables:
    get:
      tags:
      - tables
      summary: List all tables
      description: Returns a list of all tables in the database
      responses:
        '200':
          description: List of tables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Table'
  /tables/{tableName}:
    get:
      tags:
      - tables
      summary: Get table details
      description: Returns detailed information about a specific table
      parameters:
      - name: tableName
        in: path
        required: true
        schema:
          type: string
        description: Name of the table
      responses:
        '200':
          description: Table details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Table'
  /queries:
    get:
      tags:
      - queries
      summary: List all SQL queries
      description: Returns metadata for all SQL queries
      responses:
        '200':
          description: List of queries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Query'
  /queries/{queryNumber}:
    get:
      tags:
      - queries
      summary: Get query details
      description: Returns detailed information and SQL code for a specific query
      parameters:
      - name: queryNumber
        in: path
        required: true
        schema:
          type: integer
        description: Query number (1-30)
      responses:
        '200':
          description: Query details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Query'
components:
  schemas:
    SchemaOverview:
      type: object
      properties:
        database_name:
          type: string
          example: db-1
        database_type:
          type: string
          example: Chat/Messaging System
        created_date:
          type: string
          format: date
          example: '2026-02-03'
        total_tables:
          type: integer
          example: 11
        supported_platforms:
          type: array
          items:
            type: string
          example:
          - PostgreSQL
        table_groups:
          type: array
          items:
            $ref: '#/components/schemas/TableGroup'
    TableGroup:
      type: object
      properties:
        name:
          type: string
          example: User Management
        tables:
          type: array
          items:
            type: string
          example:
          - profiles
    Table:
      type: object
      required:
      - name
      - columns
      properties:
        name:
          type: string
          example: profiles
        description:
          type: string
          example: Stores user profile information
        columns:
          type: array
          items:
            $ref: '#/components/schemas/Column'
        indexes:
          type: array
          items:
            $ref: '#/components/schemas/Index'
        constraints:
          type: array
          items:
            $ref: '#/components/schemas/Constraint'
        foreign_keys:
          type: array
          items:
            $ref: '#/components/schemas/ForeignKey'
    Column:
      type: object
      required:
      - name
      - type
      properties:
        name:
          type: string
          example: id
        type:
          type: string
          example: UUID
        nullable:
          type: boolean
          example: false
        default:
          type: string
          nullable: true
          example: gen_random_uuid()
        description:
          type: string
          example: Primary key - unique user identifier
        primary_key:
          type: boolean
          example: true
    Index:
      type: object
      properties:
        name:
          type: string
          example: idx_profiles_username
        columns:
          type: array
          items:
            type: string
          example:
          - username
        unique:
          type: boolean
          example: true
        type:
          type: string
          example: btree
    Constraint:
      type: object
      properties:
        name:
          type: string
          example: pk_profiles
        type:
          type: string
          enum:
          - PRIMARY KEY
          - UNIQUE
          - CHECK
          - NOT NULL
          example: PRIMARY KEY
        columns:
          type: array
          items:
            type: string
          example:
          - id
    ForeignKey:
      type: object
      properties:
        name:
          type: string
          example: fk_chats_created_by
        from_table:
          type: string
          example: chats
        from_column:
          type: string
          example: created_by
        to_table:
          type: string
          example: profiles
        to_column:
          type: string
          example: id
    Query:
      type: object
      required:
      - number
      - title
      - sql
      properties:
        number:
          type: integer
          example: 1
        title:
          type: string
          example: Production-Grade User Activity Analysis
        description:
          type: string
          example: Enterprise-level user activity analysis
        complexity:
          type: string
          example: Deep nested CTEs (5+ levels)
        sql:
          type: string
          example: WITH user_registration_cohorts AS (...)
        expected_output:
          type: string
          example: Top 20 users ranked by message activity
        categories:
          type: array
          items:
            type: string
          example:
          - User Activity Analysis
          - Cohort Analytics
        database_compatibility:
          type: object
          properties:
            postgresql:
              type: boolean
              example: true
  examples:
    ProfilesTable:
      summary: Example profiles table
      value:
        name: profiles
        description: Stores user profile information
        columns:
        - name: id
          type: UUID
          nullable: false
          primary_key: true
          description: Primary key - unique user identifier
        - name: username
          type: VARCHAR(255)
          nullable: false
          description: Unique username for login
        indexes:
        - name: idx_profiles_username
          columns:
          - username
          unique: true
    QueryExample:
      summary: Example query
      value:
        number: 1
        title: Production-Grade User Activity Analysis
        description: Enterprise-level user activity analysis
        sql: WITH user_registration_cohorts AS (...) SELECT ...
        expected_output: Top 20 users ranked by message activity
