openapi: 3.0.3
info:
  title: Database db-9 - Database API Specification
  description: 'This database implements a comprehensive shipping intelligence and
    rate comparison system designed to mirror the functionality of Pirate Ship (https://www.pirateship.com/).
    The system provides multi-carrier rate comparison, zone analysis, tracking analytics,
    address validation, and cost optimization capabilities. The database integrates
    with USPS Developer Portal, UPS Developer Portal, U.S. Census Bureau International
    Trade Data, and Data.gov to provide shipping intelligence and analytics.


    - Multi-Carrier Rate Comparison: Compare rates across USPS, UPS, and other carriers
    with zone-based analysis and cost optimization

    - Zone Analysis: Shipping zone calculations, geographic distribution analysis,
    and transit time optimization

    - Tracking Analytics: Comprehensive tracking event analysis, delivery prediction,
    and anomaly detection

    - Address Validation: USPS address validation and standardization with quality
    metrics

    - Cost Optimization: Dimensional weight optimization, rate optimization, and cost
    savings analysis

    - International Shipping: Customs duty and tax analysis, international route optimization

    - Performance Analytics: Carrier performance comparison, delivery time analysis,
    API performance monitoring

    - Data Integration: ETL/ELT pipelines pulling 1+ GB of data from public APIs (USPS,
    UPS, Census Bureau, Data.gov)


    - PostgreSQL: Full support with standard SQL features

    - Snowflake: Full support with VARIANT types for JSON data


    This database powers a shipping intelligence platform sourced from businesses
    with at least $1M ARR per year. The queries demonstrate production-grade patterns
    used by:

    - Pirate Ship: Multi-carrier rate comparison and shipping cost optimization

    - ShipStation: Shipping automation and multi-carrier management

    - Shippo: Shipping API and rate comparison platform

    - EasyShip: Multi-carrier shipping platform with rate comparison

    - ShippingEasy: E-commerce shipping solutions with carrier comparison


    ---


    ---


    This section provides a comprehensive data dictionary for all tables in the database,
    including column names, data types, constraints, and descriptions. Tables are
    organized by functional category for easier navigation.


    The Shipping Intelligence Database (db-9) provides comprehensive shipping rate
    comparison, zone analysis, tracking analytics, and cost optimization capabilities.
    The schema is designed to support multi-carrier shipping intelligence similar
    to Pirate Ship''s functionality.


    The database consists of 15 core tables organized into the following categories:


    - shipping_carriers: Carrier information (USPS, UPS, FedEx, etc.)

    - shipping_zones: Zone information for rate calculations

    - shipping_service_types: Available service types (Priority Mail, Ground, Express,
    etc.)

    - shipping_rates: Historical and current shipping rates

    - packages: Package information for shipments

    - shipments: Shipment records with origin and destination


    - tracking_events: Tracking events for shipments

    - rate_comparison_results: Rate comparison results across carriers

    - address_validation_results: Address validation results from USPS Address API

    - shipping_adjustments: Shipping adjustments and discrepancies

    - shipping_analytics: Aggregated shipping analytics and metrics

    - international_customs: Customs information for international shipments

    - api_rate_request_log: API rate request logs for monitoring


    - bulk_shipping_presets: Preset configurations for bulk shipping


    Stores carrier information including USPS, UPS, FedEx, and other shipping carriers.


    Key Columns:

    - `carrier_id` (VARCHAR(50), PK): Unique carrier identifier

    - `carrier_name` (VARCHAR(100)): Carrier display name

    - `carrier_code` (VARCHAR(10), UNIQUE): Carrier code (USPS, UPS, FEDEX)

    - `carrier_type` (VARCHAR(50)): Carrier type (Postal, Courier, Freight)

    - `api_endpoint` (VARCHAR(500)): API endpoint URL

    - `commercial_pricing_available` (BOOLEAN): Whether commercial pricing is available

    - `active_status` (BOOLEAN): Whether carrier is currently active


    Stores zone information for rate calculations. Zones determine shipping rates
    based on origin and destination ZIP codes.


    Key Columns:

    - `zone_id` (VARCHAR(255), PK): Unique zone identifier

    - `carrier_id` (VARCHAR(50), FK): Reference to shipping_carriers

    - `origin_zip_code` (VARCHAR(10)): Origin ZIP code

    - `destination_zip_code` (VARCHAR(10)): Destination ZIP code

    - `zone_number` (INTEGER): Zone number (1-8 for domestic)

    - `zone_type` (VARCHAR(50)): Zone type (Domestic, International, Alaska, Hawaii)

    - `distance_miles` (NUMERIC(10, 2)): Distance in miles

    - `transit_days_min` (INTEGER): Minimum transit days

    - `transit_days_max` (INTEGER): Maximum transit days


    Stores available service types for each carrier (e.g., Priority Mail, Ground,
    Express).


    Key Columns:

    - `service_id` (VARCHAR(255), PK): Unique service identifier

    - `carrier_id` (VARCHAR(50), FK): Reference to shipping_carriers

    - `service_code` (VARCHAR(50)): Service code

    - `service_name` (VARCHAR(255)): Service display name

    - `service_category` (VARCHAR(100)): Service category (Express, Ground, Priority,
    Economy)

    - `max_weight_lbs` (NUMERIC(10, 2)): Maximum weight in pounds

    - `tracking_included` (BOOLEAN): Whether tracking is included

    - `insurance_available` (BOOLEAN): Whether insurance is available


    Stores historical and current shipping rates for different carriers, services,
    zones, and weights.


    Key Columns:

    - `rate_id` (VARCHAR(255), PK): Unique rate identifier

    - `carrier_id` (VARCHAR(50), FK): Reference to shipping_carriers

    - `service_id` (VARCHAR(255), FK): Reference to shipping_service_types

    - `zone_id` (VARCHAR(255), FK): Reference to shipping_zones

    - `weight_lbs` (NUMERIC(10, 4)): Package weight in pounds

    - `rate_amount` (NUMERIC(10, 2)): Base rate amount

    - `total_rate` (NUMERIC(10, 2)): Total rate including surcharges

    - `rate_type` (VARCHAR(50)): Rate type (Retail, Commercial, Daily, Cubic)

    - `effective_date` (DATE): When rate becomes effective

    - `expiration_date` (DATE): When rate expires


    Stores package information including dimensions, weight, and package type.


    Key Columns:

    - `package_id` (VARCHAR(255), PK): Unique package identifier

    - `weight_lbs` (NUMERIC(10, 4)): Package weight in pounds

    - `length_inches` (NUMERIC(10, 2)): Package length in inches

    - `width_inches` (NUMERIC(10, 2)): Package width in inches

    - `height_inches` (NUMERIC(10, 2)): Package height in inches

    - `dimensional_weight_lbs` (NUMERIC(10, 4)): Calculated dimensional weight

    - `package_type` (VARCHAR(50)): Package type (Envelope, Box, Tube, Flat)

    - `package_value` (NUMERIC(10, 2)): Declared package value


    Stores shipment records with origin and destination addresses, carrier selection,
    and shipment status.


    Key Columns:

    - `shipment_id` (VARCHAR(255), PK): Unique shipment identifier

    - `package_id` (VARCHAR(255), FK): Reference to packages

    - `carrier_id` (VARCHAR(50), FK): Reference to shipping_carriers

    - `service_id` (VARCHAR(255), FK): Reference to shipping_service_types

    - `tracking_number` (VARCHAR(255)): Carrier tracking number

    - `origin_zip_code` (VARCHAR(10)): Origin ZIP code

    - `destination_zip_code` (VARCHAR(10)): Destination ZIP code

    - `total_cost` (NUMERIC(10, 2)): Total shipment cost

    - `shipment_status` (VARCHAR(50)): Shipment status (Pending, Label Created, In
    Transit, Delivered, Exception)

    - `estimated_delivery_date` (DATE): Estimated delivery date

    - `actual_delivery_date` (DATE): Actual delivery date


    Stores tracking events for shipments, providing visibility into package movement.


    Key Columns:

    - `event_id` (VARCHAR(255), PK): Unique event identifier

    - `shipment_id` (VARCHAR(255), FK): Reference to shipments

    - `tracking_number` (VARCHAR(255)): Tracking number

    - `event_timestamp` (TIMESTAMP_NTZ): Event timestamp

    - `event_type` (VARCHAR(100)): Event type (Label Created, In Transit, Out for
    Delivery, Delivered, Exception)

    - `event_location` (VARCHAR(255)): Event location

    - `event_description` (VARCHAR(1000)): Event description

    - `raw_event_data` (VARIANT): Raw JSON data from carrier API


    - `shipping_zones.carrier_id` → `shipping_carriers.carrier_id`

    - `shipping_service_types.carrier_id` → `shipping_carriers.carrier_id`

    - `shipping_rates.carrier_id` → `shipping_carriers.carrier_id`

    - `shipping_rates.service_id` → `shipping_service_types.service_id`

    - `shipping_rates.zone_id` → `shipping_zones.zone_id`

    - `shipments.package_id` → `packages.package_id`

    - `shipments.carrier_id` → `shipping_carriers.carrier_id`

    - `shipments.service_id` → `shipping_service_types.service_id`

    - `shipments.zone_id` → `shipping_zones.zone_id`

    - `tracking_events.shipment_id` → `shipments.shipment_id`


    The schema includes indexes for performance optimization:


    - `idx_shipping_zones_carrier_origin_dest`: Index on carrier_id, origin_zip_code,
    destination_zip_code

    - `idx_shipping_rates_carrier_service`: Index on carrier_id, service_id

    - `idx_shipping_rates_weight`: Index on weight_lbs

    - `idx_shipments_tracking_number`: Index on tracking_number

    - `idx_shipments_status`: Index on shipment_status

    - `idx_tracking_events_shipment`: Index on shipment_id

    - `idx_tracking_events_timestamp`: Index on event_timestamp

    - `idx_rate_comparison_package`: Index on package_id

    - `idx_address_validation_zip`: Index on validated_zip_code

    - `idx_api_rate_request_log_carrier`: Index on carrier_id, request_timestamp


    The schema uses standard SQL data types compatible with PostgreSQL:


    - VARCHAR: Variable-length strings

    - NUMERIC: Decimal numbers with precision

    - INTEGER: Whole numbers

    - BOOLEAN: True/false values

    - DATE: Date values

    - TIMESTAMP_NTZ: Timestamp without timezone

    - VARIANT: JSON/variant data (Snowflake/Databricks)


    The schema is designed to work across:

    - PostgreSQL: Full support with standard SQL

    - Databricks: Delta Lake compatible

    - Snowflake: Full support with VARIANT for JSON data


    1. Rate Lookups: Use `shipping_rates` table with joins to `shipping_zones` for
    zone-based rate calculations

    2. Tracking: Query `tracking_events` filtered by `shipment_id` or `tracking_number`
    for package tracking

    3. Address Validation: Use `address_validation_results` for address validation
    and standardization

    4. Analytics: Query `shipping_analytics` for aggregated metrics and `rate_comparison_results`
    for rate comparisons


    ---

    Last Updated: 2026-02-04


    ---


    ---


    ---


    This database includes 30 production SQL queries, each designed to solve specific
    business problems for companies with $1M+ ARR. Each query includes:


    - Business Use Case: The specific business problem this query solves

    - Description: Technical explanation of what the query does

    - Client Deliverable: What output or report this query generates

    - Business Value: The business impact and value delivered

    - Complexity: Technical complexity indicators

    - SQL Code: Complete, production-ready SQL query


    ---


    Use Case: Shipping platform needs to compare rates across USPS, UPS, and other
    carriers for a package and recommend the most cost-effective option based on weight,
    dimensions, and destination zone.


    Description: Comprehensive rate comparison across multiple carriers with zone-based
    analysis, dimensional weight calculations, and cost optimization recommendations.
    Uses multiple CTEs to calculate rates, compare carriers, identify cheapest options,
    and analyze cost savings potential.


    Use Case: Shipping platform needs to compare rates across USPS, UPS, and other
    carriers for a package and recommend the most cost-effective option based on weight,
    dimensions, and destination zone.


    Business Value: Enables shippers to save up to 87% on shipping costs by automatically
    identifying the cheapest carrier and service type for each shipment, similar to
    Pirate Ship''s rate comparison functionality.


    Purpose: Provide real-time rate comparison and cost optimization recommendations
    to help users select the most economical shipping option.


    Complexity: Multiple CTEs (5+ levels), zone calculations, dimensional weight logic,
    rate aggregation, window functions for ranking, cost savings calculations, carrier
    comparison analytics.


    Expected Output: Rate comparison results showing cheapest carrier, fastest carrier,
    cost savings potential, and detailed rate breakdowns for all available options.


    ---


    Use Case: Shipping platform needs to analyze zone distributions across carriers,
    identify zones with longest transit times, and optimize shipping routes based
    on geographic patterns.


    Description: Advanced zone analysis query that calculates shipping zone distributions,
    analyzes transit time patterns, identifies optimal shipping routes, and provides
    geographic shipping intelligence. Uses recursive CTEs for zone path analysis and
    multiple aggregations for geographic insights.


    Use Case: Shipping platform needs to analyze zone distributions across carriers,
    identify zones with longest transit times, and optimize shipping routes based
    on geographic patterns.


    Business Value: Helps optimize shipping operations by identifying zones with faster
    transit times, understanding geographic shipping patterns, and enabling route
    optimization for cost and time savings.


    Purpose: Provide geographic shipping intelligence and zone-based analytics to
    support strategic shipping decisions and route optimization.


    Complexity: Recursive CTEs for zone path analysis, multiple aggregations, window
    functions for ranking zones, geographic calculations, transit time analysis, carrier
    comparison across zones.


    Expected Output: Zone analysis results showing zone distributions, average transit
    times by zone, geographic shipping patterns, and optimization recommendations.


    ---


    Use Case: Shipping platform needs to analyze tracking event patterns, predict
    delivery dates based on historical data, identify shipments with potential delays,
    and provide delivery insights to users.


    Description: Advanced tracking analytics query that analyzes shipment tracking
    events, identifies delivery patterns, predicts delivery dates, and detects anomalies.
    Uses multiple CTEs for event sequencing, pattern recognition, and predictive analytics.


    Use Case: Shipping platform needs to analyze tracking event patterns, predict
    delivery dates based on historical data, identify shipments with potential delays,
    and provide delivery insights to users.


    Business Value: Improves customer experience by providing accurate delivery predictions,
    early warning of potential delays, and insights into carrier performance patterns.


    Purpose: Enable predictive delivery analytics and tracking pattern analysis to
    improve shipping visibility and customer satisfaction.


    Complexity: Multiple CTEs (6+ levels), event sequencing with window functions,
    pattern recognition logic, predictive date calculations, anomaly detection, carrier
    performance analysis.


    Expected Output: Tracking analytics showing delivery predictions, event patterns,
    anomaly detection results, and carrier performance metrics.


    ---


    Use Case: Shipping platform needs to analyze address validation performance, identify
    common address errors, measure correction rates, and improve address validation
    accuracy.


    Description: Comprehensive address validation analysis that evaluates validation
    quality, correction rates, and address standardization effectiveness. Uses multiple
    CTEs to analyze validation patterns, identify common correction types, and measure
    validation accuracy.


    Use Case: Shipping platform needs to analyze address validation performance, identify
    common address errors, measure correction rates, and improve address validation
    accuracy.


    Business Value: Reduces shipping errors, improves delivery success rates, and
    minimizes address-related shipping costs by identifying and correcting address
    issues before shipment creation.


    Purpose: Provide address validation analytics and quality metrics to improve address
    accuracy and reduce shipping errors.


    Complexity: Multiple CTEs (4+ levels), address comparison logic, validation pattern
    analysis, correction rate calculations, quality metrics aggregation.


    Expected Output: Address validation analytics showing validation rates, correction
    patterns, quality metrics, and recommendations for improving address accuracy.


    ---


    Use Case: Shipping platform needs to analyze shipping costs, identify revenue
    opportunities, compare carrier performance, and optimize shipping spend.


    Description: Comprehensive shipping cost analytics that analyzes revenue, identifies
    cost optimization opportunities, compares carrier performance, and provides financial
    insights. Uses multiple CTEs for cost aggregation, carrier comparison, and revenue
    analysis.


    Use Case: Shipping platform needs to analyze shipping costs, identify revenue
    opportunities, compare carrier performance, and optimize shipping spend.


    Business Value: Enables cost optimization, identifies revenue opportunities, and
    provides insights for strategic shipping decisions to maximize profitability.


    Purpose: Provide financial analytics and cost optimization insights to improve
    shipping profitability and operational efficiency.


    Complexity: Multiple CTEs (5+ levels), cost aggregation, revenue calculations,
    carrier performance comparison, optimization recommendations, financial metrics.


    Expected Output: Shipping cost analytics showing revenue metrics, cost breakdowns,
    carrier performance comparisons, and optimization recommendations.


    ---


    Use Case: Shipping platform needs to optimize bulk shipping presets to reduce
    costs, improve efficiency, and provide better default configurations for frequent
    shippers.


    Description: Analyzes bulk shipping presets to optimize package configurations,
    weight distributions, and shipping costs. Uses multiple CTEs to analyze preset
    usage patterns, identify optimization opportunities, and recommend cost-effective
    preset configurations.


    Use Case: Shipping platform needs to optimize bulk shipping presets to reduce
    costs, improve efficiency, and provide better default configurations for frequent
    shippers.


    Business Value: Reduces shipping costs for bulk shippers by optimizing preset
    configurations, improving shipping efficiency, and enabling better cost management.


    Purpose: Optimize bulk shipping operations by analyzing preset usage and recommending
    cost-effective configurations.


    Complexity: Multiple CTEs (4+ levels), weight distribution analysis, preset usage
    patterns, cost optimization calculations, aggregation analytics.


    Expected Output: Bulk shipping preset optimization results showing recommended
    configurations, cost savings potential, and usage patterns.


    ---


    Use Case: Shipping platform needs to analyze international shipping customs data,
    optimize duty and tax calculations, and provide customs clearance insights for
    international shipments.


    Description: Comprehensive international shipping customs analysis that calculates
    duty and tax amounts, identifies optimization opportunities, and analyzes customs
    clearance patterns. Uses multiple CTEs for customs value calculations, duty optimization,
    and clearance analytics.


    Use Case: Shipping platform needs to analyze international shipping customs data,
    optimize duty and tax calculations, and provide customs clearance insights for
    international shipments.


    Business Value: Reduces international shipping costs by optimizing customs declarations,
    identifying duty savings opportunities, and improving customs clearance success
    rates.


    Purpose: Provide international shipping customs analytics and optimization recommendations
    to reduce costs and improve clearance efficiency.


    Complexity: Multiple CTEs (5+ levels), customs value calculations, duty and tax
    optimization, clearance pattern analysis, international shipping analytics.


    Expected Output: International customs analysis showing duty amounts, tax calculations,
    optimization opportunities, and clearance success rates.


    ---


    Use Case: Shipping platform needs to analyze shipping adjustments, identify discrepancy
    patterns, and recover costs from carrier adjustments.


    Description: Analyzes shipping adjustments to identify discrepancies, detect patterns,
    and calculate cost recovery opportunities. Uses multiple CTEs to analyze adjustment
    types, identify root causes, and quantify financial impact.


    Use Case: Shipping platform needs to analyze shipping adjustments, identify discrepancy
    patterns, and recover costs from carrier adjustments.


    Business Value: Reduces shipping costs by identifying and preventing adjustment
    discrepancies, recovering costs from incorrect adjustments, and improving shipping
    accuracy.


    Purpose: Provide shipping adjustment analytics to identify discrepancies, prevent
    future adjustments, and recover costs.


    Complexity: Multiple CTEs (4+ levels), adjustment pattern analysis, discrepancy
    detection, cost recovery calculations, root cause analysis.


    Expected Output: Shipping adjustment analysis showing adjustment types, discrepancy
    patterns, cost recovery opportunities, and prevention recommendations.


    ---


    Use Case: Shipping platform needs to optimize API rate requests to reduce latency,
    minimize errors, and improve overall API performance.


    Description: Analyzes API rate request performance to identify bottlenecks, optimize
    request patterns, and improve API efficiency. Uses multiple CTEs to analyze response
    times, error rates, and request patterns.


    Use Case: Shipping platform needs to optimize API rate requests to reduce latency,
    minimize errors, and improve overall API performance.


    Business Value: Improves API performance, reduces latency, minimizes API costs,
    and enhances user experience by optimizing rate request patterns.


    Purpose: Provide API performance analytics and optimization recommendations to
    improve rate request efficiency.


    Complexity: Multiple CTEs (5+ levels), API performance analysis, response time
    calculations, error pattern detection, optimization recommendations.


    Expected Output: API performance analysis showing response times, error rates,
    optimization opportunities, and performance recommendations.


    ---


    Use Case: Shipping platform needs a comprehensive analytics dashboard showing
    revenue trends, shipment volumes, carrier performance, and operational metrics
    for business intelligence.


    Description: Comprehensive shipping analytics dashboard that aggregates revenue
    trends, performance metrics, and operational insights. Uses multiple CTEs to calculate
    key performance indicators, trend analysis, and comparative metrics.


    Use Case: Shipping platform needs a comprehensive analytics dashboard showing
    revenue trends, shipment volumes, carrier performance, and operational metrics
    for business intelligence.


    Business Value: Provides actionable business intelligence for strategic decision-making,
    performance monitoring, and revenue optimization.


    Purpose: Deliver comprehensive shipping analytics and business intelligence insights
    for strategic planning and performance monitoring.


    Complexity: Multiple CTEs (6+ levels), revenue trend analysis, performance metrics
    aggregation, comparative analytics, time-series analysis.


    Expected Output: Shipping analytics dashboard showing revenue trends, shipment
    volumes, performance metrics, and business intelligence insights.


    ---


    Use Case: Shipping platform needs to optimize package dimensions to minimize dimensional
    weight charges and reduce shipping costs.


    Description: Analyzes dimensional weight calculations to optimize package configurations
    and reduce shipping costs. Uses multiple CTEs to calculate dimensional weights,
    identify optimization opportunities, and recommend cost-effective package configurations.


    Use Case: Shipping platform needs to optimize package dimensions to minimize dimensional
    weight charges and reduce shipping costs.


    Business Value: Reduces shipping costs by optimizing package dimensions, minimizing
    dimensional weight charges, and improving packaging efficiency.


    Purpose: Provide dimensional weight optimization recommendations to reduce shipping
    costs and improve packaging efficiency.


    Complexity: Multiple CTEs (4+ levels), dimensional weight calculations, package
    optimization logic, cost savings analysis.


    Expected Output: Dimensional weight optimization results showing recommended package
    configurations and cost savings potential.


    ---


    Use Case: Shipping platform needs to identify geographic areas with limited zone
    coverage and optimize shipping routes.


    Description: Analyzes shipping zone coverage to identify geographic gaps, optimize
    zone coverage, and improve shipping route efficiency. Uses multiple CTEs with
    recursive logic to analyze zone coverage patterns.


    Use Case: Shipping platform needs to identify geographic areas with limited zone
    coverage and optimize shipping routes.


    Business Value: Improves shipping coverage, reduces shipping costs, and enables
    better route optimization by identifying geographic gaps.


    Purpose: Provide zone coverage analytics to identify gaps and optimize shipping
    route coverage.


    Complexity: Multiple CTEs (5+ levels), recursive zone analysis, geographic gap
    detection, coverage optimization.


    Expected Output: Zone coverage analysis showing coverage gaps, optimization opportunities,
    and route recommendations.


    ---


    Use Case: Shipping platform needs to analyze rate volatility, predict price trends,
    and optimize rate selection to minimize costs.


    Description: Analyzes shipping rate volatility to identify price trends, predict
    rate changes, and optimize rate selection timing. Uses multiple CTEs for time-series
    analysis and trend prediction.


    Use Case: Shipping platform needs to analyze rate volatility, predict price trends,
    and optimize rate selection to minimize costs.


    Business Value: Reduces shipping costs by predicting rate changes, optimizing
    rate selection timing, and identifying cost-saving opportunities.


    Purpose: Provide rate volatility analytics and trend predictions to optimize shipping
    cost management.


    Complexity: Multiple CTEs (5+ levels), time-series analysis, volatility calculations,
    trend prediction, rate optimization.


    Expected Output: Rate volatility analysis showing price trends, volatility metrics,
    and optimization recommendations.


    ---


    Use Case: Shipping platform needs to compare carrier service performance to recommend
    the best carrier-service combination for different shipping needs.


    Description: Compares carrier service performance across different routes and
    time periods, analyzing delivery times, success rates, and service reliability.
    Uses multiple CTEs for performance comparison and reliability analysis.


    Use Case: Shipping platform needs to compare carrier service performance to recommend
    the best carrier-service combination for different shipping needs.


    Business Value: Improves shipping reliability and customer satisfaction by recommending
    optimal carrier-service combinations based on performance data.


    Purpose: Provide carrier service performance analytics to support optimal carrier
    selection decisions.


    Complexity: Multiple CTEs (5+ levels), performance comparison, delivery time analysis,
    reliability metrics, service ranking.


    Expected Output: Carrier service performance comparison showing delivery times,
    success rates, and reliability metrics.


    ---


    Use Case: Shipping platform needs to optimize routes by analyzing cost-time trade-offs
    and identifying the most efficient shipping paths.


    Description: Analyzes shipping routes to optimize cost and time trade-offs, identifying
    optimal routes based on multiple factors including cost, transit time, and reliability.


    Use Case: Shipping platform needs to optimize routes by analyzing cost-time trade-offs
    and identifying the most efficient shipping paths.


    Business Value: Reduces shipping costs and improves delivery times by optimizing
    route selection based on comprehensive cost-time analysis.


    Purpose: Provide route optimization analytics to identify optimal shipping paths
    balancing cost and time.


    Complexity: Multiple CTEs (5+ levels), route analysis, cost-time optimization,
    path finding algorithms, multi-factor decision analysis.


    Expected Output: Route optimization results showing optimal routes, cost-time
    trade-offs, and efficiency metrics.


    ---


    Use Case: Shipping platform needs to understand cost structure and identify opportunities
    to reduce shipping costs through component-level analysis.


    Description: Comprehensive cost breakdown analysis that attributes shipping costs
    to different components (base rate, surcharges, insurance, signature, etc.) and
    identifies cost optimization opportunities.


    Use Case: Shipping platform needs to understand cost structure and identify opportunities
    to reduce shipping costs through component-level analysis.


    Business Value: Enables cost optimization by identifying high-cost components
    and providing actionable insights for cost reduction.


    Purpose: Provide detailed cost breakdown analytics to understand shipping cost
    structure and identify savings opportunities.


    Complexity: Multiple CTEs (4+ levels), cost component analysis, cost attribution,
    optimization recommendations, cost trend analysis.


    Expected Output: Cost breakdown analysis showing component costs, cost attribution,
    and optimization recommendations.


    ---


    Use Case: Shipping platform needs to identify tracking event patterns, detect
    anomalies, and predict potential delivery issues before they occur.


    Description: Advanced tracking event pattern recognition that identifies normal
    delivery patterns, detects anomalies, and predicts potential issues using machine
    learning-like pattern analysis.


    Use Case: Shipping platform needs to identify tracking event patterns, detect
    anomalies, and predict potential delivery issues before they occur.


    Business Value: Improves delivery reliability by detecting anomalies early and
    enabling proactive issue resolution.


    Purpose: Provide tracking pattern recognition and anomaly detection to improve
    shipping reliability and customer satisfaction.


    Complexity: Multiple CTEs (6+ levels), pattern recognition, anomaly detection,
    sequence analysis, predictive analytics, statistical analysis.


    Expected Output: Tracking pattern analysis showing normal patterns, detected anomalies,
    and predictive insights.


    ---


    Use Case: Shipping platform needs to measure address validation quality, analyze
    correction impact, and track quality trends.


    Description: Comprehensive address validation quality metrics that analyze validation
    accuracy, correction impact, and quality trends over time.


    Use Case: Shipping platform needs to measure address validation quality, analyze
    correction impact, and track quality trends.


    Business Value: Improves address accuracy, reduces shipping errors, and enables
    data quality improvements.


    Purpose: Provide address validation quality metrics and correction impact analysis
    to improve address data quality.


    Complexity: Multiple CTEs (4+ levels), quality metrics calculation, correction
    impact analysis, trend analysis, quality scoring.


    Expected Output: Address validation quality metrics showing accuracy rates, correction
    impact, and quality trends.


    ---


    Use Case: Shipping platform needs to analyze international shipping routes and
    optimize them considering customs, duties, and transit times.


    Description: Comprehensive international shipping route analysis that optimizes
    routes considering customs requirements, duty rates, and transit times.


    Use Case: Shipping platform needs to analyze international shipping routes and
    optimize them considering customs, duties, and transit times.


    Business Value: Reduces international shipping costs and improves delivery times
    by optimizing routes and customs handling.


    Purpose: Provide international route optimization considering customs, duties,
    and transit efficiency.


    Complexity: Multiple CTEs (5+ levels), international route analysis, customs optimization,
    duty rate analysis, transit time optimization.


    Expected Output: International route analysis showing optimal routes, customs
    considerations, and cost-time trade-offs.


    ---


    Use Case: Shipping platform needs a comprehensive rate comparison matrix to identify
    the best carrier-service combinations across different scenarios.


    Description: Comprehensive carrier rate comparison matrix that compares rates
    across multiple dimensions including weight, zone, service type, and time periods.


    Use Case: Shipping platform needs a comprehensive rate comparison matrix to identify
    the best carrier-service combinations across different scenarios.


    Business Value: Enables optimal carrier selection by providing comprehensive rate
    comparisons across all relevant dimensions.


    Purpose: Provide multi-dimensional rate comparison matrix for optimal carrier
    selection decisions.


    Complexity: Multiple CTEs (6+ levels), multi-dimensional analysis, rate matrix
    generation, comparative analytics, optimization recommendations.


    Expected Output: Rate comparison matrix showing carrier rates across multiple
    dimensions and optimal selections.


    ---


    Use Case: Shipping platform needs to optimize package dimensions to minimize dimensional
    weight charges and improve packaging efficiency.


    Description: Advanced package dimension optimization that analyzes volume efficiency,
    identifies optimal package configurations, and recommends dimension adjustments
    to minimize shipping costs.


    Use Case: Shipping platform needs to optimize package dimensions to minimize dimensional
    weight charges and improve packaging efficiency.


    Business Value: Reduces shipping costs by optimizing package dimensions and minimizing
    dimensional weight charges.


    Purpose: Provide package dimension optimization recommendations to reduce shipping
    costs and improve packaging efficiency.


    Complexity: Multiple CTEs (5+ levels), dimension optimization, volume efficiency
    analysis, cost minimization, geometric calculations.


    Expected Output: Package dimension optimization results showing recommended dimensions
    and cost savings potential.


    ---


    Use Case: Shipping platform needs to analyze zone transit times, evaluate reliability,
    and identify zones with performance issues.


    Description: Comprehensive zone transit time analysis that evaluates actual vs
    expected transit times, calculates reliability metrics, and identifies zones with
    performance issues.


    Use Case: Shipping platform needs to analyze zone transit times, evaluate reliability,
    and identify zones with performance issues.


    Business Value: Improves shipping reliability by identifying zones with transit
    time issues and enabling proactive improvements.


    Purpose: Provide zone transit time analytics to evaluate reliability and identify
    performance issues.


    Complexity: Multiple CTEs (5+ levels), transit time analysis, reliability metrics,
    performance evaluation, zone ranking.


    Expected Output: Zone transit time analysis showing actual vs expected times,
    reliability metrics, and performance rankings.


    ---


    Use Case: Shipping platform needs to optimize customs duties by analyzing tariff
    codes and identifying cost reduction opportunities.


    Description: Advanced customs duty optimization that analyzes tariff codes, duty
    rates, and identifies opportunities to reduce customs costs through proper classification.


    Use Case: Shipping platform needs to optimize customs duties by analyzing tariff
    codes and identifying cost reduction opportunities.


    Business Value: Reduces international shipping costs by optimizing customs duty
    classification and identifying cost savings.


    Purpose: Provide customs duty optimization through tariff code analysis and classification
    optimization.


    Complexity: Multiple CTEs (5+ levels), tariff code analysis, duty optimization,
    classification analysis, cost reduction recommendations.


    Expected Output: Customs duty optimization results showing tariff code analysis
    and cost reduction opportunities.


    ---


    Use Case: Shipping platform needs to optimize API rate caching to reduce API calls,
    improve performance, and minimize costs.


    Description: Comprehensive API rate cache optimization that analyzes cache hit
    rates, identifies caching opportunities, and optimizes cache strategies to reduce
    API calls and improve performance.


    Use Case: Shipping platform needs to optimize API rate caching to reduce API calls,
    improve performance, and minimize costs.


    Business Value: Reduces API costs and improves performance by optimizing cache
    strategies and maximizing cache hit rates.


    Purpose: Provide API cache optimization analytics to reduce API calls and improve
    performance.


    Complexity: Multiple CTEs (4+ levels), cache hit rate analysis, cache optimization,
    API call reduction, performance improvement.


    Expected Output: API cache optimization results showing hit rates, caching opportunities,
    and performance improvements.


    ---


    Use Case: Shipping platform needs revenue forecasts for business planning, budgeting,
    and strategic decision-making.


    Description: Advanced revenue forecasting that uses historical data, trend analysis,
    and predictive modeling to forecast future shipping revenue.


    Use Case: Shipping platform needs revenue forecasts for business planning, budgeting,
    and strategic decision-making.


    Business Value: Enables accurate revenue planning and strategic decision-making
    through predictive revenue forecasting.


    Purpose: Provide revenue forecasting capabilities for business planning and strategic
    decision-making.


    Complexity: Multiple CTEs (6+ levels), time-series analysis, trend analysis, predictive
    modeling, revenue forecasting, statistical analysis.


    Expected Output: Revenue forecasts showing predicted revenue, confidence intervals,
    and trend analysis.


    ---


    Use Case: Shipping platform needs to benchmark carrier performance against industry
    standards and identify best practices.


    Description: Comprehensive carrier performance benchmarking that compares carrier
    performance against industry standards and identifies best practices.


    Use Case: Shipping platform needs to benchmark carrier performance against industry
    standards and identify best practices.


    Business Value: Enables performance improvement by benchmarking against industry
    standards and identifying best practices.


    Purpose: Provide carrier performance benchmarking to evaluate performance relative
    to industry standards.


    Complexity: Multiple CTEs (5+ levels), performance benchmarking, industry standard
    comparison, best practice identification, performance scoring.


    Expected Output: Carrier performance benchmarks showing performance relative to
    industry standards and best practices.


    ---


    Use Case: Shipping platform needs to analyze dimensional weight costs and provide
    optimization recommendations to reduce charges.


    Description: Comprehensive dimensional weight cost analysis that quantifies the
    impact of dimensional weight charges and provides optimization recommendations.


    Use Case: Shipping platform needs to analyze dimensional weight costs and provide
    optimization recommendations to reduce charges.


    Business Value: Reduces shipping costs by optimizing package dimensions to minimize
    dimensional weight charges.


    Purpose: Provide dimensional weight cost analysis and optimization recommendations
    to reduce shipping costs.


    Complexity: Multiple CTEs (4+ levels), dimensional weight analysis, cost impact
    quantification, optimization recommendations, cost savings calculation.


    Expected Output: Dimensional weight cost analysis showing cost impact and optimization
    recommendations.


    ---


    Use Case: Shipping platform needs route efficiency metrics to evaluate route performance
    and identify optimization opportunities.


    Description: Advanced route efficiency analysis that calculates efficiency metrics,
    scores route performance, and identifies optimization opportunities.


    Use Case: Shipping platform needs route efficiency metrics to evaluate route performance
    and identify optimization opportunities.


    Business Value: Improves shipping efficiency by identifying inefficient routes
    and enabling route optimization.


    Purpose: Provide route efficiency metrics and performance scoring to enable route
    optimization.


    Complexity: Multiple CTEs (5+ levels), efficiency metrics calculation, performance
    scoring, route ranking, optimization identification.


    Expected Output: Route efficiency metrics showing efficiency scores, performance
    rankings, and optimization opportunities.


    ---


    Use Case: Shipping platform needs to aggregate rates from multiple carriers and
    select the best option based on cost, time, and reliability.


    Description: Comprehensive multi-carrier rate aggregation that aggregates rates
    from multiple carriers, compares options, and selects the best rate based on multiple
    criteria.


    Use Case: Shipping platform needs to aggregate rates from multiple carriers and
    select the best option based on cost, time, and reliability.


    Business Value: Enables optimal carrier selection by aggregating and comparing
    rates across all available carriers.


    Purpose: Provide multi-carrier rate aggregation and best rate selection for optimal
    carrier choice.


    Complexity: Multiple CTEs (6+ levels), rate aggregation, multi-criteria decision
    analysis, best rate selection, carrier comparison.


    Expected Output: Multi-carrier rate aggregation showing all available rates and
    best rate selections.


    ---


    Use Case: Shipping platform needs a comprehensive dashboard showing all key shipping
    intelligence metrics and real-time analytics.


    Description: Comprehensive shipping intelligence dashboard that aggregates all
    key metrics, provides real-time analytics, and delivers actionable insights for
    strategic decision-making.


    Use Case: Shipping platform needs a comprehensive dashboard showing all key shipping
    intelligence metrics and real-time analytics.


    Business Value: Provides comprehensive shipping intelligence for strategic decision-making
    and performance monitoring.


    Purpose: Deliver comprehensive shipping intelligence dashboard with real-time
    analytics and actionable insights.


    Complexity: Multiple CTEs (7+ levels), comprehensive aggregation, real-time analytics,
    multi-dimensional analysis, dashboard metrics, strategic insights.


    Expected Output: Comprehensive dashboard showing all key shipping intelligence
    metrics, trends, and actionable insights.


    ---


    1. Create Database: Run `data/schema.sql` to create the database schema

    2. Load Sample Data: Run `data/data.sql` to load sample data

    3. Run Queries: Execute queries from this document for shipping intelligence analytics


    Use `research/etl_elt_pipeline.ipynb` for data integration from:

    - USPS Developer Portal API

    - UPS Developer Portal API

    - U.S. Census Bureau International Trade Data

    - Data.gov datasets


    For bulk data extraction (1 GB+), use:


    Run validation suite:


    ---


    Last Updated: 2026-02-04


    ---


    All queries in this database are designed to work across multiple database platforms:


    - PostgreSQL: Full support with standard SQL features


    Queries use standard SQL syntax and avoid platform-specific features to ensure
    compatibility.


    ---


    Document Information:


    - Generated: 20260210-0115

    - Database: db-9

    - Type: Shipping Intelligence Database

    - Queries: 30 production queries

    - Status: ✅ Complete Comprehensive Deliverable'
  version: 1.0.0
  contact:
    name: Database Team
  license:
    name: MIT
servers:
- url: postgresql://localhost:5432/db_9
  description: PostgreSQL Server
tags:
- name: schema
  description: Database schema information
- name: tables
  description: Table definitions and structures
- name: queries
  description: SQL query definitions and metadata
- name: relationships
  description: Table relationships and foreign keys
paths:
  /schema:
    get:
      tags:
      - schema
      summary: Get database schema overview
      description: Returns overview information about the database schema
      responses:
        '200':
          description: Schema overview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaOverview'
  /tables:
    get:
      tags:
      - tables
      summary: List all tables
      description: Returns a list of all tables in the database
      responses:
        '200':
          description: List of tables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Table'
  /tables/{tableName}:
    get:
      tags:
      - tables
      summary: Get table details
      description: Returns detailed information about a specific table
      parameters:
      - name: tableName
        in: path
        required: true
        schema:
          type: string
        description: Name of the table
      responses:
        '200':
          description: Table details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Table'
  /queries:
    get:
      tags:
      - queries
      summary: List all SQL queries
      description: Returns metadata for all SQL queries
      responses:
        '200':
          description: List of queries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Query'
  /queries/{queryNumber}:
    get:
      tags:
      - queries
      summary: Get query details
      description: Returns detailed information and SQL code for a specific query
      parameters:
      - name: queryNumber
        in: path
        required: true
        schema:
          type: integer
        description: Query number (1-30)
      responses:
        '200':
          description: Query details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Query'
components:
  schemas:
    SchemaOverview:
      type: object
      properties:
        database_name:
          type: string
          example: db-1
        database_type:
          type: string
          example: Chat/Messaging System
        created_date:
          type: string
          format: date
          example: '2026-02-03'
        total_tables:
          type: integer
          example: 11
        supported_platforms:
          type: array
          items:
            type: string
          example:
          - PostgreSQL
        table_groups:
          type: array
          items:
            $ref: '#/components/schemas/TableGroup'
    TableGroup:
      type: object
      properties:
        name:
          type: string
          example: User Management
        tables:
          type: array
          items:
            type: string
          example:
          - profiles
    Table:
      type: object
      required:
      - name
      - columns
      properties:
        name:
          type: string
          example: profiles
        description:
          type: string
          example: Stores user profile information
        columns:
          type: array
          items:
            $ref: '#/components/schemas/Column'
        indexes:
          type: array
          items:
            $ref: '#/components/schemas/Index'
        constraints:
          type: array
          items:
            $ref: '#/components/schemas/Constraint'
        foreign_keys:
          type: array
          items:
            $ref: '#/components/schemas/ForeignKey'
    Column:
      type: object
      required:
      - name
      - type
      properties:
        name:
          type: string
          example: id
        type:
          type: string
          example: UUID
        nullable:
          type: boolean
          example: false
        default:
          type: string
          nullable: true
          example: gen_random_uuid()
        description:
          type: string
          example: Primary key - unique user identifier
        primary_key:
          type: boolean
          example: true
    Index:
      type: object
      properties:
        name:
          type: string
          example: idx_profiles_username
        columns:
          type: array
          items:
            type: string
          example:
          - username
        unique:
          type: boolean
          example: true
        type:
          type: string
          example: btree
    Constraint:
      type: object
      properties:
        name:
          type: string
          example: pk_profiles
        type:
          type: string
          enum:
          - PRIMARY KEY
          - UNIQUE
          - CHECK
          - NOT NULL
          example: PRIMARY KEY
        columns:
          type: array
          items:
            type: string
          example:
          - id
    ForeignKey:
      type: object
      properties:
        name:
          type: string
          example: fk_chats_created_by
        from_table:
          type: string
          example: chats
        from_column:
          type: string
          example: created_by
        to_table:
          type: string
          example: profiles
        to_column:
          type: string
          example: id
    Query:
      type: object
      required:
      - number
      - title
      - sql
      properties:
        number:
          type: integer
          example: 1
        title:
          type: string
          example: Production-Grade User Activity Analysis
        description:
          type: string
          example: Enterprise-level user activity analysis
        complexity:
          type: string
          example: Deep nested CTEs (5+ levels)
        sql:
          type: string
          example: WITH user_registration_cohorts AS (...)
        expected_output:
          type: string
          example: Top 20 users ranked by message activity
        categories:
          type: array
          items:
            type: string
          example:
          - User Activity Analysis
          - Cohort Analytics
        database_compatibility:
          type: object
          properties:
            postgresql:
              type: boolean
              example: true
  examples:
    ProfilesTable:
      summary: Example profiles table
      value:
        name: profiles
        description: Stores user profile information
        columns:
        - name: id
          type: UUID
          nullable: false
          primary_key: true
          description: Primary key - unique user identifier
        - name: username
          type: VARCHAR(255)
          nullable: false
          description: Unique username for login
        indexes:
        - name: idx_profiles_username
          columns:
          - username
          unique: true
    QueryExample:
      summary: Example query
      value:
        number: 1
        title: Production-Grade User Activity Analysis
        description: Enterprise-level user activity analysis
        sql: WITH user_registration_cohorts AS (...) SELECT ...
        expected_output: Top 20 users ranked by message activity
